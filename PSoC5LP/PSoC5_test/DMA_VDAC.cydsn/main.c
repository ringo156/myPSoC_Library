/* ========================================
 *
 * Copyright YOUR COMPANY, THE YEAR
 * All Rights Reserved
 * UNPUBLISHED, LICENSED SOFTWARE.
 *
 * CONFIDENTIAL AND PROPRIETARY INFORMATION
 * WHICH IS THE PROPERTY OF your company.
 *
 * ========================================
*/
#include "project.h"

const uint8 sin_dat[200];
uint8 cos_dat[200];
uint8 n;
//
//Main
int main()
{
//DMA1
uint8 DMA_1_Chan;
uint8 DMA_1_TD[1];
#define DMA_1_BYTES_PER_BURST 1 //バースト1転送
#define DMA_1_REQUEST_PER_BURST 1 //バースト1転送req
#define DMA_1_SRC_BASE (CYDEV_SRAM_BASE) //転送元アドレス
#define DMA_1_DST_BASE (CYDEV_PERIPH_BASE) //転送先アドレス
//
DMA_1_Chan = DMA_1_DmaInitialize(DMA_1_BYTES_PER_BURST,DMA_1_REQUEST_PER_BURST,HI16(DMA_1_SRC_BASE), HI16(DMA_1_DST_BASE));
DMA_1_TD[0] = CyDmaTdAllocate();
CyDmaTdSetConfiguration(DMA_1_TD[0], 200,DMA_1_TD[0], TD_INC_SRC_ADR);
CyDmaTdSetAddress(DMA_1_TD[0], LO16((uint32)cos_dat), LO16((uint32)VDAC8_1_Data_PTR));
CyDmaChSetInitialTd(DMA_1_Chan, DMA_1_TD[0]);
CyDmaChEnable(DMA_1_Chan, 1);
//DMA2
uint8 DMA_2_Chan;
uint8 DMA_2_TD[1];
#define DMA_2_BYTES_PER_BURST 1
#define DMA_2_REQUEST_PER_BURST 1
#define DMA_2_SRC_BASE (sin_dat)
#define DMA_2_DST_BASE (CYDEV_PERIPH_BASE)
DMA_2_Chan = DMA_2_DmaInitialize(DMA_2_BYTES_PER_BURST, DMA_2_REQUEST_PER_BURST,HI16(DMA_2_SRC_BASE), HI16(DMA_2_DST_BASE));
DMA_2_TD[0] = CyDmaTdAllocate();
CyDmaTdSetConfiguration(DMA_2_TD[0], 200, DMA_2_TD[0], TD_INC_SRC_ADR);
CyDmaTdSetAddress(DMA_2_TD[0], LO16((uint32)sin_dat), LO16((uint32)VDAC8_2_Data_PTR));
CyDmaChSetInitialTd(DMA_2_Chan, DMA_2_TD[0]);
CyDmaChEnable(DMA_2_Chan, 1);

//LCD_Char_1_Start(); //LCDスタート
VDAC8_1_SetRange(VDAC8_1_RANGE_1V); //1V Setteing
VDAC8_2_SetRange(VDAC8_2_RANGE_1V); //1V Setteing
VDAC8_1_Start(); //dacスタート
VDAC8_2_Start(); //dacスタート
CyGlobalIntEnable; 
for(n=1;n<149;n++) //dataのコピ
{cos_dat[n+50]=sin_dat[n];}
for(n=150;n<200;n++)
{cos_dat[n-149]=sin_dat[n];}
/*
LCD_Char_1_Position(0,0);
LCD_Char_1_PrintString("VDac_DMA_out"); //タイトル 
LCD_Char_1_Position(1,0);
LCD_Char_1_PrintString("Sin_Wave "); 
*/
for(;;)
{
//メインコードはなし 
}
}

const uint8 sin_dat[200]={ //サイン台形波形データ 
0x07F,0x082,0x086,0x08A,0x08E,0x092,0x096,0x09A,0x09E,0x0A2,
0x0A6,0x0AA,0x0AD,0x0B1,0x0B5,0x0B8,0x0BC,0x0BF,0x0C3,0x0C6,
0x0C9,0x0CC,0x0CF,0x0D2,0x0D5,0x0D8,0x0DB,0x0DE,0x0E0,0x0E3,
0x0E5,0x0E8,0x0EA,0x0EC,0x0EE,0x0F0,0x0F1,0x0F3,0x0F5,0x0F6,
0x0F7,0x0F8,0x0FA,0x0FA,0x0FB,0x0FC,0x0FC,0x0FD,0x0FD,0x0FD,
0x0FE,0x0FD,0x0FD,0x0FD,0x0FC,0x0FC,0x0FB,0x0FA,0x0FA,0x0F8,
0x0F7,0x0F6,0x0F5,0x0F3,0x0F1,0x0F0,0x0EE,0x0EC,0x0EA,0x0E8,
0x0E5,0x0E3,0x0E0,0x0DE,0x0DB,0x0D8,0x0D5,0x0D2,0x0CF,0x0CC,
0x0C9,0x0C6,0x0C3,0x0BF,0x0BC,0x0B8,0x0B5,0x0B1,0x0AD,0x0AA,
0x0A6,0x0A2,0x09E,0x09A,0x096,0x092,0x08E,0x08A,0x086,0x082,
0x07F,0x07E,0x07A,0x076,0x072,0x06E,0x06A,0x066,0x062,0x05E,
0x05A,0x056,0x053,0x04F,0x04B,0x048,0x044,0x041,0x03D,0x03A,
0x037,0x034,0x031,0x02E,0x02B,0x028,0x025,0x022,0x020,0x01D,
0x01B,0x018,0x016,0x014,0x012,0x010,0x00F,0x00D,0x00B,0x00A,
0x009,0x008,0x006,0x006,0x005,0x004,0x004,0x003,0x003,0x003,
0x002,0x003,0x003,0x003,0x004,0x004,0x005,0x006,0x006,0x008,
0x009,0x00A,0x00B,0x00D,0x00F,0x010,0x012,0x014,0x016,0x018,
0x01B,0x01D,0x020,0x022,0x025,0x028,0x02B,0x02E,0x031,0x034,
0x037,0x03A,0x03D,0x041,0x044,0x048,0x04B,0x04F,0x053,0x056,
0x05A,0x05E,0x062,0x066,0x06A,0x06E,0x072,0x076,0x07A,0x07E
};